このリポジトリは、はてなブログのデザインテーマを作成するためのリポジトリです。

# ディレクトリ構成

| パス | 説明 |
| ---- | ---- |
| .github/ | GitHub Actionsの設定ファイル |
| build/ | ビルド成果物、本番はてなブログにはこのファイルを配布する |
| js/ | はてなブログ向けのJavaScriptのソースコード |
| node_modules/ | npmのモジュール |
| screenshots/ | Playwrightで取得したスクリーンショット |
| scss/ | はてなブログ向けのSCSSのソースコード |
| tests/ | PlaywrightのE2Eテストコード |
| .gitignore | Gitの無視リスト |
| article.md | はてなブログのサンプルエントリー記事。これをはてなブログの記事として利用する。 |
| packge-lock.json | npmのパッケージロックファイル |
| package.json | npmのパッケージファイル |
| playwright.config.js | Playwrightの設定ファイル |
| README.md | このリポジトリの説明 |
| server.js | ローカル開発サーバーの動作ファイル |
| toc-script.html | はてなブログのHTMLヘッダーメタに貼り付けるHTML |
| vite.config.js | Viteの設定ファイル |

# 基本的なルール

* ユーザーとのやり取りは日本語で行います。
* デザインテーマのコードレイアウトは、[README.md](../README.md)を参照してください。
* デザインテーマの確認には、README.mdに記載されているnpmコマンドを実行してローカル開発サーバーを立ち上げる必要がありますが、あなたに指示する前に実行されているものとします。
* はてなブログのデザインテーマは、デザインテーマ制作の手引きにしたがって作成してください。
* デザインテーマで目指す見た目は、目指すテーマの仕様にしたがって作成してください。
* 動作確認に必要なローカル開発サーバーは`npm start -- guitarrapc-theme.hatenablog.com`で起動でき、変更されたscssやJSは自動的にブログへ反映されます。
* テーマのレンダリングは[トップページ](https://guitarrapc-theme.hatenablog.com/)の個別記事、及び[最新の記事](https://guitarrapc-theme.hatenablog.com/entry/2025/05/10/204601)にどのようにスタイルがあたっているかで判断しましょう。
* はてなブログのレンダリングに影響を与える作業を完了する前にPlaywrightでE2Eテストし、またンダリング結果を適宜スクリーンショットで確認してください。テストは`npm run test`で実行し、コマンドが終了するまでテスト結果の判断を待ってください。テストコードはTypeScriptを用いてください。
* Copilotのターミナルは、Windowsなら`cmd.exe`、Macなら`Terminal.app`、Linuxは`bash`を想定しています。実行するコマンドは、各ターミナルに適合したものを選択してください。

# 目指すテーマの仕様

* レスポンシブデザインのテーマとして作成し、スマートフォン、タブレット、PCの各デバイスで適切に表示されるようにします。
* シングルカラムで構成します。
* cssで`!important`は可能な限り使用しませんが、使わないとあまりに長かったり実装困難な場合は使用します。
* 記事コンテンツブロック`<dev id="main">`は画面の真ん中に配置します。
* タイトルの下部に、記事の「作成日付」`class="entry-date"`と「更新日付」`class=date-last-updated`を表示します。
* タイトルの下部の日付の下に、記事の「カテゴリー」`class="entry-categories categories"`を表示します。
* カテゴリは頭にハッシュ`#`をつけます。ハッシュの色はリンクを用い、カテゴリ自体は本文と同じ色、枠線は丸囲みで表示します。普段は背景色はつけませんが、カテゴリをマウスホバーするとカテゴリーホバー用の色で表示します。
* タイトル、日付、カテゴリの頭は揃えてください。
* エントリーヘッダーに装飾線はつけません。
* エントリーヘッダーと本文の間に余白をつけますが、必要以上に大きくしないでください。
* 記事ブロック`<div id="main-inner">`を`<div id="container-innner">`と同じ幅にします。
* 目次には記事本文中の目次とページ右上の目次ボタンで展開される目次の2つがあります。
* 記事本文中の目次は、`<ul class="table-of-contents">`でスタイル制御します。
* 記事ページの右上に「目次」ボタンを表示し、ボタンをクリックすると目次コンテンツを表示します。目次はページの右上に固定され、スクロールしても常に表示されます。
* 「目次」ボタンの見た目は、閉じているときは「目次^」、開いているときは「目次v」のように表示します。(^やvは文字ではなくいい感じのアイコン置き換えて開く/閉じるを表現します)。ボタンの背景色はページ背景と同色、ボタンの周りに薄い灰色の枠線をつけます。目次ボタンを開いた時、画面外をクリックしたり目次内のリンクをクリックしてもボタン状態をリセットする必要はありません。
* h1などの見出し要素はセンターに寄せしません。
* レンダリング調整後は、curlで最新記事にアクセスして意図したレンダリング結果か確認してください。
* 記事の下`<div id="box2">`にブログパーツ表示されます。ブログパーツのタイトルはどのパーツでも縦軸を揃えてください。

## 目次スタイルの仕様

zennの目次スタイルを参考に、目次のスタイルを以下のように実装します。

1. 目次のマーカー:
  * 青い丸形マーカー（直径8px）をリストアイテムの左側に配置
  * マーカーは見出しレベル（h1/h2）に関わらず同じ位置に揃える
  * 青い丸形の代わりに、liのリストマーカーは消します。
2. 縦線の接続:
  * 青い丸マーカーを縦に結ぶ薄い青色の縦線（幅2px）
  * 縦線はマーカーの中心を通るように配置します。(目次ボタンでは`left: 2px`)
3. 見出しレベルの表現:
  * h1: 太字、標準サイズ、濃い色（#333）
  * h2: 通常の太さ、やや小さめサイズ（0.95em）、薄い色（#777）
  * 左インデントは揃え、フォントスタイルのみで階層を表現
4. インデント位置:
  * 全項目のインデントを同じに設定し、マーカーも同じ位置に揃える
  * マーカーと項目テキストの距離も統一
  * ul/liの子要素でも、親と同じ位置に揃える

# デザインテーマ制作の手引き

本ドキュメントでは、Webデザイナーの方がはてなブログ用オリジナルテーマを作成するために必要な情報をまとめています。

## レスポンシブデザインのテーマを作成する

デザインテーマは、スマートフォンで適切に表示されるレスポンシブデザインに対応することを強く推奨します。
はてなブログでレスポンシブデザインのテーマを作成するには、次の2つの条件を満たすように作成してください。

1. Media queries（メディアクエリ）などを使用して、どのデバイスから閲覧しても適切な見た目になるよう、デザインテーマのCSSを調整する
2. テーマのCSSの先頭にResponsive: yesという行を含んだコメントを挿入する
    - テーマの開発時などで、テーマストア以外からCSSをインポート（@import）する場合は、インポート先のCSSではなく「デザインCSS」欄に直接 Responsive: yes コメントを記述してください。

例えば、[Evergreen](https://blog.hatena.ne.jp/-/store/theme/12921228815720753487)テーマでは下記のようなコメントを記述しています。なお、コメントにはテーマ作者などの情報をこのように含めるのもよいでしょう。

```css
/*
  Theme: evergreen
  Author: Hatena Blog Team
  Description:
  1カラムで文章を書くことに集中できるテーマです
  Responsive: yes
 */
```

> [!WARNING]
> 正しくレスポンシブデザインに対応していないデザインテーマは、単に画面サイズを縮小しただけのブログが表示されるなど、かえって見づらくなるおそれがあります。必ず、ここでの説明に従ってテーマを作成してください。また、作成後にさまざまなデバイス幅で動作確認を行ってください。


### 付録: はてなブログのレスポンシブデザインテーマの挙動
デザインテーマのCSSにResponsive: yesのコメントが記述されている場合、はてなブログでは下記のようにスマートフォンデバイスに適したviewportをHTMLヘッダーで指定します。

## はてなブログのページ構成

はてなブログは、次のような種類のページで構成されています。それぞれのページが正しく見られるようにデザインする必要があります。

```
トップページ
┣ パーマリンク（記事ページ）
┣ Aboutページ
┣ Archiveページ
┣ Archive/Categoryページ
┗ Searchページ
```


### 各ページの例

上記のページは、サンプルのブログ を例に取ると、それぞれ次のURLが該当します。

| ページの種類 | URLの例 |
| ---- | ---- |
| トップページ | http://sample.hatenastaff.com/ |
| パーマリンク（記事ページ） | top_url/entry/2013/01/25/121312 |
| Aboutページ | top_url/about |
| Archiveページ | top_url/archive |
| Archive（年間） | top_url/archive/2012 |
| Archive（月間） | top_url/archive/2012/01 |
| Archive（日付ごと） | top_url/archive/2013/01/09 |
| Archive（カテゴリー） | top_url/archive/category/%E6%96%B0%E6%A9%9F%E8%83%BD |
| Searchページ | top_url/search?q=%E3%81%AF%E3%81%A6%E3%81%AA |

※ `top_url`にはブログのトップページのURL（ここではhttp://sample.hatenastaff.com/）を当てはめてください。

## CSSチェックリスト

オリジナルのテーマを作成するには、少なくとも以下の箇所に対してCSSを書く必要があります。このチェックリストをもとに、書き忘れた箇所がないか確認しましょう。

* ブログタイトル
* ブログのひとこと説明
* 記事
  * 日付
  * カテゴリー
  * 「編集」リンク
  * はてなブログタグへのリンク
  * 記事下の広告
  * 記事下の関連記事
    * 関連するとみられる記事がブログ内にあるとき表示されます。表示されない場合は、いくつか記事を投稿し、しばらく時間をおいてください。
  * コメント欄
* サイドバーモジュール
  * プロフィール、最新記事などの各モジュール
    * モジュールのオプションをすべて表示した状態で確認することをおすすめします
* ページャー
* フッターリンク
* Aboutページ
* Archiveページ
  * カテゴリーのパンくずリスト

### スタイルの記述が必要ないもの

以下の項目はあらかじめ標準のCSSが適用されているため、デザインテーマでスタイルの記述は不要です。

* ヘッダーメニュー
* Archiveページの検索ボックス
* 読者になるボタン
* はてなスター
* タグ
  * 必要があればコンテナ上下の余白を調整してください。

※ これらの要素にスタイルを記述した場合、将来のはてなブログの仕様変更によって、予告なく正常に表示されなくなることがあります。

## デザインとコーディングの注意事項

作成したテーマをテーマストアに投稿する際は、下記の注意事項を守ってください。

* 一般的に使用されているWebブラウザについて、各PC環境（WindowsまたはMac）の各最新版で正しく表示されるようにしてください（具体的にはヘルプ「はてなブログでの使用を推奨するWebブラウザ」を参照してください）。
  * レスポンシブデザインのテーマでは、スマートフォン環境（AndroidおよびiOS）での表示も確認してください。
* ヘッダ・フッタを移動したり隠したりしないでください。また、ヘッダメニューより上部やフッタより下部に要素を置かないでください。（border等の装飾も含む）。
* はてなブログのすべての機能が正しく使えるデザインにしてください。
  * やむを得ず一部の機能が利用できなかったり、隠れてしまう場合には、必ずテーマ ストアの「テーマの説明」欄にその旨を明記してください。
  * 機能が正常に使えないような場合には、選択されたライセンスの許諾事項に関わらず、はてなにて修正対応を行うことがございますのでご了承ください。
* テーマで使う画像のホスティングには、はてなフォトライフの利用を推奨します。
* 広告を隠したり、広告に別の要素を重ねて表示しないでください。
* カテゴリーに対して「タグ」または「ハッシュタグ（#）」の装飾を用いることは避けてください。これらのモチーフはタグを表すときに使います。
* 自分だけが使う目的で、テーマストアに非公開で投稿することは問題ありません。
  * ただし、はてなブログ以外のウェブページからCSSを参照する目的で投稿したり、はてなブログのデザインテーマに関係のないCSSを投稿した場合、テーマの公開停止や削除処置をとることがあります。

## デザインカスタマイズの仕様

### 背景画像

* ユーザーは「デザイン設定」の「カスタマイズ」タブの「背景画像」で、背景画像を設定できます。
* 用意された画像の中からも選ぶことも、ユーザーがアップロードすることもできます。
* ユーザーが背景を設定すると、選択した画像に応じて「デザインCSS」欄に下記のようなスタイルが指定されます。

```css
/* <system section="background" selected="bg1"> */
body{
 background-color:#3e2d1b;
 background-image:url('/images/theme/backgrounds/theme1.jpg');
 background-repeat:no-repeat;
 background-attachment:fixed;
 background-position:center top;
 background-size:cover; }
/* </system> */
```

### ヘッダ画像

* ユーザーは「デザイン設定」の「カスタマイズ」タブの「ヘッダ」で、自由に画像をアップロードできます。
* デフォルトで表示される画像のサイズは、高さが200px、横幅は最大1000pxです。
* ヘッダ画像を設定すると、div#blog-title-innerに下記のような専用のスタイルがインラインで指定されます。

```html
<div id="blog-title-inner" style="background-image: url('http://example.com/20121206113746.jpg');
 background-position: center ユーザーが「位置を調整する」で指定した表示領域のオフセット値 px;">
   <h1 id="title"><a href="/">はてなブログ開発検証用日記</a></h1>
   <h2 id="blog-description">ブログのひとこと説明</h2>
</div>
```

#### ヘッダ画像のクラス

* ヘッダ画像を指定すると、「表示設定」に応じてbodyタグに下記のクラスが付与されます。
* 基本的にスタイルはあらかじめ調整されており、各テーマで細かな調整を行います。

| ヘッダ画像の表示方法 | bodyに付与されるクラス |
| ---- | ---- |
| 画像なし | なし |
| 画像とテキストを表示 | header-image-enable |
| 画像だけ表示 | header-image-only |

### HTMLを自由記述できる箇所

* ユーザーは「デザイン設定」の「カスタマイズ」タブの下記の欄で、自由にHTMLを書くことができます。
* この部分には特にスタイルを書く必要はありませんが、余白などを整えてもよいでしょう。
* ユーザーが記述したHTMLは、次のようなIDやクラスが付与されたdiv内に置かれます。


| HTMLを記述できる箇所 | 表示されるページ | 付与されるセレクタ |
| ---- | ---- | ---- |
| タイトル下（ヘッダ） | すべてのページ | div#top-editarea |
| 記事上（記事） | 記事ページ | div.entry-header-html |
| 記事下（記事） | 記事ページ | div.entry-footer-html |
| フッタ | すべてのページ | div#bottom-editarea |


### Archiveページ

Archiveページは、「はてなブログのページ構成」で説明したように、過去の記事一覧を表示するページです。

Archiveページには、記事のサムネイルと本文冒頭が表示されます。以下にCSS記述例を挙げます。

```css
.page-archive .archive-entries .archive-entry {
  margin-bottom: 3em;
}
.page-archive .archive-entries .date {
  position: static;
}
.page-archive .archive-entries .entry-title {
  font-size: 130%;
  margin: 0 0 .5em;
}
.page-archive .archive-entries .categories {
  margin: 0 0 .5em;
}
.page-archive .archive-entries .entry-description {
  font-size: 100%;
  margin: 0 0 1em;
  line-height: 1.5em;
}
```

### ページャ

トップページと記事パーマリンクには、「過去の記事」「新しい記事（またはページ）」へのリンクとなるページャが表示されます。パーマリンクのページャには、記事タイトルが表示されます。以下にCSS記述例を挙げます。

```css
.pager {
    margin: 1em 0;
    display: block;
    *zoom: 1;
}
.pager:after {
    display: block;
    visibility: hidden;
    font-size: 0;
    height: 0;
    clear: both;
    content: ".";
}
.pager .pager-prev {
    float: left;
    text-align: left;
    width: 45%;
}
.pager .pager-next {
    float: right;
    text-align: right;
    width: 45%;
}
```

### ヘッダーメニュー

ヘッダーメニューとは、ブログの上部にある、はてなブログロゴやメニューが並んでいるバーです。あらかじめスタイルが適用されていますので、デザインテーマでのスタイリングは不要です。

### はてなブログPro

有料プラン「はてなブログPro」に加入しているユーザーのブログでは、はてなブログのヘッダーメニューとフッターリンクを表示しないようにできます。このときクラスなどに次のような変更があります。

* ヘッダーメニューの要素（#globalheader-container）が消える
* フッターリンクの要素（footer#footer）が消える
* 消えた状態を表すためglobalheader-offクラスがbodyに付与される
