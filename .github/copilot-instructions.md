<basic-instructions>

このリポジトリは、はてなブログのデザインテーマを作成するためのリポジトリです。
以下のルールに従って、はてなブログのデザインテーマを作成してください。

* あなたは、フロントエンドエキスパートとして、はてなブログのデザインテーマを作成するための指示を受けます。
* ユーザーとのやり取りは日本語で行います。
* はてなブログが提供するデザインテーマ制作の基本情報は、「デザインテーマ制作の手引き」セクションを参照してください。
* 本デザインテーマで目指す見た目は、「目指すテーマの仕様」セクションを参照してください。
* デザインテーマの確認には、[README.md](../README.md)に記載されているnpmコマンドを実行してローカル開発サーバーを立ち上げる必要がありますが、あなたに指示する前に実行されているものとします。開発サーバーを起動しておくことで、変更されたscssやJSは自動的にブログへ反映されます。反映のための`npm run build`は不要です。
* Copilotが用いるターミナルは、Windowsなら`cmd.exe`、Macなら`Terminal.app`、Linuxは`bash`を想定しています。実行するコマンドは、各ターミナルが扱える文法に適合したものを選択してください。
* ファイルのインデントは、.editorconfigに沿ってください。

## 基礎情報

### リポジトリのディレクトリ構成

ファイルの参照や変更の際は、以下のディレクトリ構成を参考にしてください。

| パス | 説明 |
| ---- | ---- |
| .github/ | GitHub Actionsの設定ファイル |
| .vscode/ | VSCodeの設定ファイル(scssのインデント調整に利用) |
| articles/ | はてなブログのエントリー記事 |
| build/ | ビルド成果物となるテーマ、本番はてなブログにはこのファイルを配布する |
| js/ | はてなブログ向けのJavaScriptのソースコード |
| node_modules/ | npmのモジュール |
| screenshots/ | Playwrightで取得したスクリーンショット |
| scss/ | はてなブログ向けのSCSSのソースコード |
| test-results/ | PlaywrightのE2Eテスト結果 |
| tests/ | PlaywrightのE2Eテストコード |
| .gitignore | Gitの無視リスト |
| capture-all-screenshots.js | 紹介記事向けのスクリーンショットを取得するスクリプト |
| customize-*.html | はてなブログのカスタマイズ用HTML |
| packge-lock.json | npmのパッケージロックファイル |
| package.json | npmのパッケージファイル |
| playwright.config.js | Playwrightの設定ファイル |
| README.md | このリポジトリの説明 |
| server.js | ローカル開発サーバーの動作ファイル |
| vite.config.js | Viteの設定ファイル |

### E2Eテストについて

* テーマのレンダリング結果は、[トップページ](https://guitarrapc-theme.hatenablog.com/)の個別記事、及び[最新の記事](https://guitarrapc-theme.hatenablog.com/entry/2025/05/10/204601)、[アーカイブ](https://guitarrapc-theme.hatenablog.com/archive/author/guitarrapc_tech)、[アバウト](https://guitarrapc-theme.hatenablog.com/about)を参照してください。
* SCSSやJavaScriptの変更をした場合、PlaywrightでE2Eテストを実行します。
  * E2Eテストは`npm run test`で実行し、コマンドが終了するまでテスト結果の判断を待ってください。テスト結果`test-restuls/`でエラーが発生しているかどうかを確認できます。
  * E2Eテストは自動化、繰り返し実行を前提とするため、ユーザープロンプトやキャンセルをしないと完了しないようなテストコマンドは使用しないでください。
  * E2Eテストのレンダリング結果を適宜スクリーンショットで確認してください。スクリーンショットは`screenshots/`に保存されます。
  * E2EテストのPlaywrightコードは、`tests/`以下に配置されています。
  * E2Eテスト結果は、`test-results/`に保存されます。エラーが発生すると、`test-results/`にエラーの詳細が保存されます。

### CIについて

GitHub ActionsでCIを実行して、SCSSやJavaScriptの動作を担保します。

ビルドワークフロー

* `master`ブランチにpushした、PRが作成された際に自動で実行されます。
* `npm run build`でビルドを実行します。
* `npm run test`でE2Eテストを実行します。

リリースワークフロー

* タグがpushされた際に自動で実行されます。
* `npm run build`でビルドを実行します。
* [gh](https://cli.github.com/manual/gh_release_create)コマンドを使ってGitHubリリースをドラフトで作成します。
  * リリース文章は`--generate-notes`オプションを指定して自動生成します。
  * リリースアーティファクトとして、`build/`以下のファイル + `customize-*.html`ファイルをzip圧縮してリリースに添付します。

## デザインテーマではないがプロダクトとして必要なもの

デザインテーマ自体はSCSSによるスタイリングとJavaScriptによる動作を組み合わせて作成しますが、デザインテーマ以外に必要なものがあります。
キャッチ画像とテーマの紹介記事を作成することで、ユーザーにテーマを知ってもらうことができます。

* テーマストア対応
* テーマの紹介記事

### テーマストアのキャッチ画像について

テーマストアは、はてなブログのテーマをユーザーが選べる無料ストア機能で、本テーマを登録するには、テーマの魅力が伝わるキャッチ画像を作成する必要があります。

* はてなブログテーマストアで用いる、このテーマの魅力を伝えるキャッチ画像`theme-store-catch.png`を作ってください。
* テーマストアのHTMLは、`theme-store-catch.html`とします。CSSはHTML内に記載します。
* テーマストア画像をキャプチャするJavaScriptは、`capture-theme-store-catch.js`とします。
* 利用できる画像は、620×460ピクセル、対応画像形式：JPEG、PNG、GIFです。
* テーマストア画像は、HTML/CSSを使用して1つの画像に複数のスクリーンショットを配置し、テーマ名やキャッチコピーを追加します。
* このHTMLファイルをブラウザでレンダリングした結果をキャプチャします。キャプチャには、Playwrightを用いましょう。
* テーマ画像は、スタイリッシュで本テーマでレンダリングとかけ離れないようにしましょう。テーマ画像は、テーマを使ってがっかりするような印象誘導を起こしてはいけません。
* 生成された画像を確認して、スクリーンショットが正しく表示されているか、テーマ名やキャッチコピーが適切に配置されているかを確認してください。

### テーマの紹介記事について

本テーマの紹介記事を作成します。テーマストアの紹介文に、このテーマ紹介記事をリンクします。テーマの紹介記事は、本テーマ自身を用いたブログエントリーとして作成します。

* テーマの紹介エントリーは`articles/introduce-entry.md`に書きます。
* テーマの名前やコンセプトは、`scss/style.scss`に書かれています。
* 紹介記事には、テーマの特徴、デザイン・見た目 (PC、タブレット、スマートフォンそれぞれのみためスクリーンショット)、テーマを導入してから行う設定 (はてなブログの管理画面からスマートフォンでレスポンシブデザインに設定すること、はてなブログProの契約者はトップページを一覧形式にすること)、カスタマイズ方法について触れてください。
* レスポンシブテーマの設定方法を、テーマインストール後に必ず設定する必要がある点を強調してください。
* 「美しい」などの抽象的な表現は避け、具体的なデザイン要素や機能に焦点を当ててください。

紹介記事で用いるスクリーンショットについて

* スクリーンショットは、ページ上部(画面解像度のheight分だけ)、目次、コードハイライトの部分を切り取ってスクリーンショットを取得し、それぞれ適切な紹介セクションで利用します。
  * PC向けのスクリーンショットは、Surface Pro7の解像度(912x1368px)で取得してください。
  * スマートフォン向けのスクリーンショットは、iPhone 14 Pro Maxの解像度(430x932px)で取得してください。
  * タブレット向けのスクリーンショットは、iPad Pro 12.9インチの解像度(1024x1366px)で取得してください。
* スクリーンショット素材として、テーマがすでに適用されている[サンプルエントリー](https://guitarrapc-theme.hatenablog.com/entry/2025/05/10/204601)、[アーカイブ一覧ページ](https://guitarrapc-theme.hatenablog.com/archive/author/guitarrapc_tech)、[コードのハイライトエントリー](https://guitarrapc-theme.hatenablog.com/entry/2025/05/12/131258)を用います。カテゴリー表示は、サンプルエントリーのタイトル下にあるカテゴリーセクション用います。コメントは、サンプルエントリーのコメントセクションを用います。
* 記事で利用するスクリーンショットは`capture-all-screenshots.js`で取得します。単一スクリプトにすることで、スクリーンショットの取得を簡素化します。
  * 記事用のスクリーンショットは、`articles/screenshots/`においてください。ただし記事からのスクリーンショット参照は`screenshots/`を用います。
  * 記事中の画像参照は、はてなフォトのURLである必要があります。しかし元画像との紐づけが分からなくなるのは困るので、HTMLコメントで`screenshots/画像ファイル`と紐づけてください。はてなフォトのURLはいじらないでください。
* 関連エントリーは、`.customized-footer .hatena-module-related-entries`を意図しています。スクリーンショットもこれを利用してください。
* コードのハイライトエントリーは、Python、C#、Goで同一処理内容を書いています。コードのスクリーンショットは、PC向けだけ取得すればOKです。

## はてなブログのHTML構造について

これははてなブログのHTMLの要素についての説明です。はてなブログのHTMLは、ページごとに以下のような構成になっています。

* ページは大きく分けて、記事部分`<div id="wrapper">`、ブログフッター部分`<aside id="box">`の2つのブロックで構成されます。 記事部分の下に、ブログフッター部分があります。
* 記事部分は、記事ページ、アーカイブページ、アバウトページで構造が異なります。それぞれは別セクションで説明します。
* ブログフッター部分は、ブログパーツを配置する`<div id="box2-inner">`があり、flexboxでブログパーツを配置します。flexboxは、横に最大3つ配置されます。ブログパーツはユーザーがカスタマイズ可能です。
    * ブログパーツは、それぞれ`<div class="hatena-module hatena-module-XXXXX">`で構成されます。ブログパーツごとにXXXXはユーザーがカスタマイズ可能です。ブログテーマとしてはXXXXに入る文字は予想できず静的に決め打つしかありません。テーマカスタマイズのため、XXXXはユーザーに提示する必要があります。
    * ブログパーツの中身は、モジュールタイトル`div class="hatena-module-title">`、モジュールの中身`<div class="hatena-module-body">`で構成されます。
    * ブログパーツの一つに検索`div class="hatena-module hatena-module-search-box"`があります。
    * ブログパーツの一つにカテゴリー`div class="hatena-module hatena-module-category"`があります。
    * ブログパーツの一つにリンク`div class="hatena-module hatena-module-links"`があります。
    * ブログパーツの一つに最新記事`div class="hatena-module hatena-module-recent-entries"`があります。
    * ブログパーツの一つに月別アーカイブ`div class="hatena-module hatena-module-archive"`があります。
    * ブログパーツの一つに関連記事`div class="hatena-module hatena-module-related-entries"`があります。
    * ブログパーツの一つにプロフィール`div class="hatena-module hatena-module-profile"`があります。
    * ブログパーツの一つに注目記事`div class="hatena-module hatena-module-entries-access-ranking"`があります。
    * ブログパーツの一つに最近のコメント`div class="hatena-module hatena-module-entries-recent-comments"`があります。
    * ブログパーツの一つに最近の参加グループ`div class="hatena-module hatena-module-entries-circles"`があります。
    * ブログパーツの一つに最近の執筆者リスト`div class="hatena-module hatena-module-authors-list"`があります。

記事ページについて

* 記事全体(記事全体コンテンツ)は`<div id="main"><div id="main-inner"><記事の数分のarticle要素><div class="pager pager-permalink permalink"></div></div></div>`で構成されます。
    * 記事全体コンテンツは、各記事(記事コンテンツ)が`<article class="entry 他"><div class="entry-innner">記事ごとの構成要素</div></article>`で構成されます。トップページなら`<article>`要素は複数あり、記事ページなら1つだけ存在します。
      * 記事ごとの構成要素は、記事ヘッダー`<header class="entry-header">`、記事本文`<div class="entry-content hatenablog-entry">`、記事フッター`<footer class="entry-fotter">`の3つのブロックで構成されます。
          * 記事ヘッダーは、記事タイトル`<h1 class="entry-title">` (トップページでは`<div class="entry-title">`)、作成日付`<time class="date entry-date first">`、更新日付`<span class="date-last-updated">`(トップページでは省略される)、カテゴリ`<div class="entry-categories categories categories">`(0-複数ありえる)で構成されます。
          * 記事本文は、`<div class="entry-content hatenablog-entry">`ブロックに直接配置されます。
          * 記事フッターは、描画されていない`<div class="entry-tags-wrapper">`、著者と記事日付の`<div class="entry-footer-selection">`、ソーシャルボタン`<div class="social-buttons">`、カスタマイズフッター`<div class="customized-fotter">`、コメント`div class="comment-box js-comment-box">`、が含まれます。
            * カスタマイズフッターは、記事詳細では関連記事が表示されます。トップページでは描画されません。
              * 関連記事は、`<div class="hatena-module hatena-module-related-entries">`要素で描画され、関連記事のタイトルは`<div class="hatena-module-title">`、関連記事の中身は`<div class="hatena-module-body"><ul class="related-entries hatena-urllist urllist-with-thumbnails">関連記事のliが並ぶ</ul></div>`で構成されます。
              * 関連記事は`<li class="uirllist-item rlated-entries-item">`にサムネイル、タイトル、日付、記事冒頭部の4つの要素が含まれます。
                * サムネイルは`<a class="urllist-image-link related-entries-image-link"><image class="urllist-imagerelated-entries-image"></a>`、タイトルは`<a class="urllist-title-link related-entries-title-link  urllist-title related-entries-title">`、日付は`<div class="urllist-date-link related-entries-date-link">`、記事冒頭部は`<div class="urllist-entry-body related-entries-entry-body">`で構成されます。
            * コメントは、一連のコメント`<ul class="comment js-comment"></ul>`、コメントは、ul要素の中に`<li class="entry-comment js-entry-comment">`、コメント用のボタン`<a class="leave-comment-title js-leave-comment-title">`で構成されます
              * コメントがない場合は、コメント用のボタンのみ表示され、コメントは描画されません。
              * li要素の中に、ユーザー名`<p class="comment-user-name">`、コメント本文`<p class="comment-content">`、投稿日付`<p class="comment-metadata">`、コメント削除用のボタン`<a class="comment-delete-button js-comment-delete-button">` (管理者のみ)、が含まれます。
    * 記事コンテンツの下に、ページャー`<div class="pager pager-permalink permalink">`があり、次の記事へのリンクが配置されます。
      * ページャーは、前の記事へのリンク`<span class="prev-entry">`、次の記事へのリンク`<span class="next-entry">`で構成されます。もし前の記事がなければ`<span class="prev-entry">`は描画されません。もし次の記事がなければ`<span class="next-entry">`は描画されません。

アーカイブページについて

* アーカイブ全体(アーカイブ全体コンテンツ)は、`<div id="main"><div id="main-inner"><div class="archive-entries"><アーカイブ記事分のsection要素></div></div></div>`のように構成されます。
  * アーカイブ記事は各アーカイブ記事が`<section class="archive-entry">アーカイブの構成要素</section>`で構成されます。
    * アーカイブの構成要素は、エントリーヘッダー`<div class="archive-entry-header">`、カテゴリー`<div class="categories">`、サムネイル`<a class="entry-thumblink">`、記事のボディ`<div class="entry-body">`で構成されます。
      * エントリーヘッダーは、記事タイトル`<h1 class="entry-title">`、作成日付`<div class="date archive-date"`で構成されています。
      * カテゴリーは、`<a class="archive-category-link">`(0-複数ありえる)で構成されます。
      * 記事ボディは、記事冒頭部分`<p class="entry-description">`、タグラッパー`<div class="archive-entry-tags-wrapper">`、ソーシャルボタン`<span class="social-buttons">`で構成されています。

アバウトページについて

* アバウト全体(アバウント全体コンテンツ)は、`<div id="main"><div id="main-inner"><article class="entry"></article></div></div>`で構成されます。
  * アバウトは、`<article class="entry"><div class="entry-inner"><div class="entry-content">アバウトの内容</div></div></article>`で構成されます。
    * 記事本文は、`<div class="entry-content">`ブロックに直接配置されます。
    * 記事本文は、ユーザーが自由に記述できるため、HTMLの構造は決まっていません。ユーザーが自由に記述したHTMLがそのまま表示されます。ただし、ユーザーが追加したHTMLの下に`<dl>`要素があり、プロフィール`<dt>プロフィール</dt><dd>プロフィール要素</dd>`、ブログ投稿数`<dt>ブログ投稿数</dt><dd>n 記事</dd>`、ブログ投稿日数`<dt>ブログ投稿日数</dt><dd>n 日</dd>`で構成されます。
      * プロフィール要素は、プロフィール`<a href="プロフィールリンク"><img サムネイル画像><span>ユーザー名<></span></a>`、Pro有無`<a href="プロリンク"><i class="badge-type-pro">はてなブログPro</i></a>`で構成されます。

## 目指すテーマのスタイル仕様

* はてなブログのデザインテーマを作成します。
* レスポンシブデザインのテーマとして作成し、スマートフォン、タブレット、PCの各デバイスで適切に表示されるようにします。
* シングルカラムで構成します。
* zennのスタイルを参考にし、シンプルで読みやすいデザインを目指します。
* borderで囲む場合、角に丸みをつけます。丸みは要素によって異なります。
* どのページでも統一感のあるスタイルを持たせます。(フォントや色、余白、ボーダーの丸みなど)

### 記事ページのスタイル仕様

記事全体コンテンツについて

* 記事全体コンテンツは画面の真ん中に配置します。

記事ヘッダーについて

* 記事ヘッダーは左寄せにし、左端揃えます。
* 記事ヘッダー下部に装飾線はつけません。
* 記事タイトルの下部に、作成日付と更新日付を表示します。
* 記事タイトルの下部の日付の下にカテゴリーを表示します。
* カテゴリは頭にハッシュ`#`をつけます。ハッシュの色はリンクを用い、カテゴリ自体は本文と同じ色、枠線は丸囲みで表示します。普段は背景色はつけませんが、カテゴリをマウスホバーするとカテゴリーホバー用の色で表示します。
* カテゴリをあたかも記事エントリーの上にあるようにみせるため、タイトル/日付から縦の距離をとって記事に近く配置します。カテゴリは丸囲みのおかげで実際には記事と左端インデントがそろっていないのに統一感がでます。
* 記事ヘッダーと記事本文ブロック間の余白は、必要以上に大きくしないでください。

記事本文について

* 記事本文は、記事タイトルより左右に5px小さくします。タイトルと記事でメリハリをつける狙いです。
* 記事本文に目次が存在する場合があります。ユーザーによっては目次が存在しないこともあります。
    * 目次は「記事本文中の目次」と「ページ右上の目次ボタンで展開される目次」の2つがあります。
    * 「記事本文中の目次」と「ページ右上の目次ボタンで展開される目次」は同様の目次表示ですが、表示領域や位置が異なるためCSSスタイルを分けて制御しやすくします。
* 記事本文は左寄せにします。

記事本文中の目次について

* 記事本文中の目次は、`<ul class="table-of-contents">`でスタイル制御します。
* 目次が記事本文中に存在する場合、記事を開いた段階ではトグル状態で、目次をクリックすると目次コンテンツを表示します。
* 目次が記事本文中に存在しない場合、目次のhtml要素自体が存在しません。

ページ右上の目次ボタンで展開される目次について

* ページ右上の目次ボタンで展開される目次は、はてなブログが提供しないカスタマイズ要素です。
* 目次ボタンはcss`.toc-button`クラス、目次ボタン中の目次はcss`.floating-toc`でスタイル制御します。
* 記事ページの右上に「目次」ボタンを表示し、ボタンをクリックすると目次コンテンツを表示します。目次はページの右上に固定され、スクロールしても常に表示されます。
* 「目次」ボタンの見た目は、閉じているときは「目次^」、開いているときは「目次v」のように表示します。(^やvは文字ではなくいい感じのアイコン置き換えて開く/閉じるを表現します)。ボタンの背景色はページ背景と同色、ボタンの周りに薄い灰色の枠線をつけます。目次ボタンを開いた時、画面外をクリックしたり目次内のリンクをクリックしてもボタン状態をリセットする必要はありません。
* JavaScriptで3つの機能を提供します。
  * 記事本文中の目次要素を拾って、目次ボタン及び目次をDOMに追加します。
  * 現在スクロールで表示しているセクションに該当する目次項目の青丸マーカーを濃い色で表示します。
  * 表示された目次コンテンツの上に「ページトップへ」ボタンを設定。ボタンをクリックすると、ページの一番上にスクロールします。

カスタマイズフッターの関連記事について

* 関連記事が複数ある場合、関連記事を2列で表示し、左から右の順に並べます。
* 個別の関連記事は左にサムネイル、回り込んでサムネイルの右にタイトルと日付を描画します。記事冒頭部は表示しません。日付はタイトルの下に表示します。配置の調整がしやすいようにグリッドレイアウトを使用します。

コメントについて

* コメントと関連記事の間に薄い灰色の線を引きます。
* コメントはzennのDiscussionスタイルのように表示します。
* `comment-box`の一番上に、`&::before`を使って`Discuttion`というタイトル文字列を大きさ1.2em、`font-weight: bold`で表示します。文字列は左寄せにします。
* コメントが複数ある場合、コメントの間にdottedな薄い灰色の線を引きます。
* 個別のコメントは左にコメントユーザーのアイコン(liで描画)、回り込んでアイコンの右にユーザー名、コメント本文、投稿日付を描画します。上段にユーザー名、投稿日付の順に表示し、コメント本文を下段に表示します。配置の調整がしやすいようにグリッドレイアウトを使用します。
* コメントユーザー名は黒色、投稿日付は薄い色、コメント本文は記事本文と同色で表示します。
* コメントボタンは別途下にスタイルを示します。

コメントボタンについて

* コメントのaタグにははてなブログが自動的に文字列を仕込みますが表示させず、代わりに吹き出しSVGを背景として表示します。
* はてなブログが仕込む文字列は`text-indent: -9999px;`で画面外に飛ばします。
* 吹き出しアイコンは大きさはは40px、`background-size: 100%`にします。
* 吹き出しアイコンは円形吹き出し、灰色に設定、背景色なし、ホバー時も変化しません。

ページャーについて

* ページャーは、センター寄せにします
* ページャーの前の記事へのリンク、次の記事へのリンクの間隔を開けますが、必要以上に大きくししない。
* ページャーの前の記事や次の記事は、ボタンで囲むのではなくNoteのように文字列だけにします
* ページャーの<<や>>を消す。代わりに、タイトルの上に灰色で「前の記事」「次の記事」を表示します
* ページャーと記事の間に、Noteのような薄い灰色の線を引きます
* ページャーとフッターの間に、Noteのような薄い灰色の線を引きます。

### アーカイブページのスタイル仕様

アーカイブページは、記事ページと同じスタイルを一部利用しますがレイアウト領域の違いがあります。アーカイブページ用のスタイルは、`.page-archive`クラスを用いて制御します。

アーカイブ全体コンテンツについて

* アーカイブ全体コンテンツは画面の真ん中に配置します。
* 個別のアーカイブ記事を、グリッドレイアウトを使用して表示します。デスクトップでは3列、スマートフォンでは1列で表示します。

個別のアーカイブ記事について

* アーカイブ記事は、行方向のフレックスボックスとして表示されます。スマートフォン版では縦並びに切り替わります。
* アーカイブ記事は、サムネイル、記事タイトル、作成日付、カテゴリー、ソーシャルボタンを表示します。記事冒頭部分は表示しません。
* サムネイルはPC表示時は記事幅に合わせて表示し、高さは180pxに固定します。
* カテゴリーはサムネイルに重ねて、サムネイルの左上に配置します。PCとスマホで異なるスタイルを適用します。
* 記事タイトルはリンク可能で、ホバー時に色を変化させますが、アンダーラインはつけません。

### ブログフッターのスタイル仕様

ブログフッターはページを問わず、同じスタイルです。

* ブログパーツのタイトルはどのパーツでも縦軸を揃えてください。
* `.hatena-urllist li a`で表現されるリストは、通常テキスト色とします。リンク色を用いません。通常時、ホバー時ともにアンダーラインはつけません。
* `.hatena-urllist .urllist-date-link a`の日付リンクは、薄い灰色とします。ホバー時にアンダーラインをつけます。
* 太字にしたリンク可能な要素は、通常時、ホバー時ともにアンダーラインはつけません。
* カテゴリーの各要素をタグクラウドのスタイルで表示します。

### 個別要素のスタイル仕様

ページに含まれる個別要素のスタイル仕様を示します。

#### 目次スタイルの実装とデザイン仕様

目次は、記事本文中の目次とページ右上の目次ボタンで展開される目次の2つがありますが、両方とも見た目は同じものを目指します。
ただし、レイアウト領域の違いによる影響がお互いに及ぶことを避けるため、SCSSは分けて実装します。(CSSのルールについて参照)

目次スタイルの詳しいデザイン指示をします。

1. 目次のマーカー:
  * liの標準リストマーカーは消す
  * 青い丸形マーカー（直径8px）をリストアイテムの左側に配置
  * マーカーは見出しレベル（h1/h2）に関わらず同じ位置に揃える
  * 青い丸形マーカーは背景色を持ち、縦線がいい感じに青いマーカーをつないでいるように見せる
2. 縦線の接続:
  * 青い丸マーカーを縦に結ぶ薄い青色の縦線（幅3px）
  * 縦線はマーカーの中心を通るように配置します。
3. 見出しレベルの表現:
  * 見出しレベルにかかわらず左インデントは揃え、フォントスタイルのみで階層を表現する
  * h1: 太字、標準サイズ、薄い色 (text-low-priority)
  * h2: 通常の太さ、やや小さめサイズ（0.95em）、薄い色 (text-low-priority)
  * マウスホバー時に背景色(bg-toc-hover)をつけ、X軸方向に広げて(3px)触っているように見せる
4. インデント位置:
  * 全項目のインデント位置を揃えるため親リスト・子リストのleftを調整、マーカーも同じ位置に揃える
  * マーカーと項目テキストの距離も統一
  * ul/liの子要素でも、親と同じ位置に揃える


#### タグクラウドのスタイルについて

タグクラウドは、タグの数を視覚的に表現するためのスタイルです。

* タグクラウドのスタイルは、各カテゴリーの記事数（カテゴリー名の後ろの括弧内に表示されている数字）に応じて、フォントサイズを変えます。記事数が多いほど、フォントサイズは大きくなり、少ないほど小さくなります。
* カテゴリーの記事数は、リンクのhref属性に含まれる括弧内の数字（例: "(3)"）を使用して判断します。
* カテゴリーの記事数による表示の違いは以下の通りに実装します:
  * 記事数が1〜5の場合（少ない記事数）: フォントサイズ0.8em
  * 記事数が6〜10の場合（やや少ない記事数）: フォントサイズ0.9em
  * 記事数が11〜20の場合（中程度の記事数）: フォントサイズ1em（標準サイズ）
  * 記事数が21〜50の場合（やや多い記事数）: フォントサイズ1.1em〜1.2em、太字
  * 記事数が51以上の場合（多い記事数）: フォントサイズ1.3em、太字
* 10の位や100の位の数字を持つカテゴリーの検出には、href属性に含まれる2桁以上の数字のパターンマッチングと、単数桁との区別のための除外条件を使用します（例: `[href*="(2"][href$=")]` かつ `:not([href*="(2)"])`）。
* 各カテゴリーは丸囲みで表示します（border-radius: 20px）。
* カテゴリーの通常時の背景色は透明、ボーダーは薄い灰色（border-light変数）。
* マウスホバー時は以下の効果を適用します:
  * 背景色が薄い青系に変化（category-hover変数）
  * 軽い影効果の追加（box-shadow）
* タグクラウドのレイアウトはflexboxを使用し、適切な間隔（gap: 0.5rem）で要素をラップして表示します。
* タグクラウドはSCSSのみで実装し、JavaScriptは使用しません。


#### コードブロックコピー機能のスタイルと実装

コードブロックコピー機能は、記事内のコードブロック（`<pre class="code">`）に対して、コードを簡単にコピーできるボタンを提供する機能です。

1. コピーボタンのデザインと配置:
   * コードブロックをラッパー要素（`div.code-block-wrapper`）で囲み、その中に相対的にボタンを配置
   * コードブロックの右上に半透明のコピーアイコンボタンを配置（SVGアイコンを使用）
   * ボタンはコードブロックにマウスホバーしたときのみ表示され（opacity: 0.75）、ボタンホバー時は完全に不透明になる
   * ボタンのサイズはデスクトップでは28px×28px、モバイルでは24px×24px に調整
   * ボタンの背景色は`$bg-code-light`変数、ボーダーも同じ色で統一感を出し、角丸は4pxに設定

2. インタラクション設計:
   * ユーザーがコードブロックにホバーするとコピーボタンが表示される
   * ボタンにホバーするとツールチップで「Copy」と表示
   * クリック時、実際のコピー実行中はボタンを一時的に非表示にして、コピー対象テキストからボタン自体を除外
   * コピー成功時は「Copied」というツールチップに変化、失敗時は「Copy failed」と表示
   * 状態変化は2秒後に自動的にリセット

3. 実装の調整:
   * コピー処理中にボタンが非表示になるため、自身のテキストがコピーされる問題を回避
   * SVGアイコンはSCSS内で`$svg-copy-code`などの変数として定義し、`url-svg`関数で変換して使用
   * ラッパー要素の導入により、既存のコードブロックスタイルを崩さず機能を追加

4. レスポンシブ対応:
   * モバイルデバイス（768px以下）ではアイコンサイズを小さく調整し、タップしやすさを維持
   * ツールチップは小さい画面でも視認しやすい配置と大きさに調整

5. ユーザー設定方法:
   * ユーザーは`customize-code-copy.html`の内容をコピーしてはてなブログの「記事上HTML」に貼り付ける
   * スクリプトは即時関数で実行され、外部スコープに影響を与えない設計

この機能は`scss/lib/_code_copy.scss`でスタイルを定義し、`js/code-copy.js`でJavaScriptの動作を実装しています。複雑なライブラリに依存せず、純粋なJavaScriptと最小限のCSS/SCSSで実装されているため、ページの読み込み速度への影響を最小限に抑えています。

### CSSのルールについて

CSSのルールは、以下のように実装します。

* cssで`!important`は可能な限り使用しませんが、使わないとあまりに長かったり実装困難な場合は使用します。
* レスポンシブデザインのテーマであるため、、メディアクエリを使用して、デバイス幅に応じたスタイルを適用します。

scssは以下のように分割して実装します。

| パス | 説明 |
| ---- | ---- |
| `lib/_core.scss` | 全体のスタイルを定義します。 |
| `lib/_table_of_contents.scss` | 記事本文中の目次のスタイルを定義します。 |
| `lib/_table_of_contents_toggle.scss` | 記事本文中の目次開閉スタイルを定義します。 |
| `lib/_table_of_contents_button.scss` | 目次ボタンとそのスタイルを定義します。 |
| `lib/_code_copy.scss` | コードブロックのコピーボタンのスタイルを定義します。 |
| `lib/_variable.scss` | 変数を定義します。 |
| `style.scss` | SCSSのビルドに必要なスタイルを定義します。 |

### JavaScriptのルールについて

JavaScriptのルールは、以下のように実装します。

* 可能な限りJavaScriptを用いてDOMを操作することは避けてください。JavaScriptを用いるのはSCSSで達成できない課題を解決するときだけにします。
  * SCSSを選択する例: すでに存在するHTML構造の順序を変更する場合はSCSSでGridスタイルを用いることで解決できるケースが多くあります。
  * JavaScriptを選択する例: コードブロックのコピー機能はSCSSで実装できないため、JavaScriptを用いています。
* JavaScriptははESモジュール形式で書きます。CommonJS形式は使用しません。
* JavaScriptは、`npm run build`がエラーなく実行できて成果物が`build/`に出力されていることを確認してください。

<basic-instructions>

<hatena-blog-design-theme-creation-guide>

# デザインテーマ制作の手引き

本ドキュメントでは、Webデザイナーの方がはてなブログ用オリジナルテーマを作成するために必要な情報をまとめています。

## レスポンシブデザインのテーマを作成する

デザインテーマは、スマートフォンで適切に表示されるレスポンシブデザインに対応することを強く推奨します。
はてなブログでレスポンシブデザインのテーマを作成するには、次の2つの条件を満たすように作成してください。

1. Media queries（メディアクエリ）などを使用して、どのデバイスから閲覧しても適切な見た目になるよう、デザインテーマのCSSを調整する
2. テーマのCSSの先頭にResponsive: yesという行を含んだコメントを挿入する
    - テーマの開発時などで、テーマストア以外からCSSをインポート（@import）する場合は、インポート先のCSSではなく「デザインCSS」欄に直接 Responsive: yes コメントを記述してください。

例えば、[Evergreen](https://blog.hatena.ne.jp/-/store/theme/12921228815720753487)テーマでは下記のようなコメントを記述しています。なお、コメントにはテーマ作者などの情報をこのように含めるのもよいでしょう。

```css
/*
  Theme: evergreen
  Author: Hatena Blog Team
  Description:
  1カラムで文章を書くことに集中できるテーマです
  Responsive: yes
 */
```

> [!WARNING]
> 正しくレスポンシブデザインに対応していないデザインテーマは、単に画面サイズを縮小しただけのブログが表示されるなど、かえって見づらくなるおそれがあります。必ず、ここでの説明に従ってテーマを作成してください。また、作成後にさまざまなデバイス幅で動作確認を行ってください。


### 付録: はてなブログのレスポンシブデザインテーマの挙動
デザインテーマのCSSにResponsive: yesのコメントが記述されている場合、はてなブログでは下記のようにスマートフォンデバイスに適したviewportをHTMLヘッダーで指定します。

## はてなブログのページ構成

はてなブログは、次のような種類のページで構成されています。それぞれのページが正しく見られるようにデザインする必要があります。

```
トップページ
┣ パーマリンク（記事ページ）
┣ Aboutページ
┣ Archiveページ
┣ Archive/Categoryページ
┗ Searchページ
```


### 各ページの例

上記のページは、サンプルのブログ を例に取ると、それぞれ次のURLが該当します。

| ページの種類 | URLの例 |
| ---- | ---- |
| トップページ | http://sample.hatenastaff.com/ |
| パーマリンク（記事ページ） | top_url/entry/2013/01/25/121312 |
| Aboutページ | top_url/about |
| Archiveページ | top_url/archive |
| Archive（年間） | top_url/archive/2012 |
| Archive（月間） | top_url/archive/2012/01 |
| Archive（日付ごと） | top_url/archive/2013/01/09 |
| Archive（カテゴリー） | top_url/archive/category/%E6%96%B0%E6%A9%9F%E8%83%BD |
| Searchページ | top_url/search?q=%E3%81%AF%E3%81%A6%E3%81%AA |

※ `top_url`にはブログのトップページのURL（ここではhttp://sample.hatenastaff.com/）を当てはめてください。

## CSSチェックリスト

オリジナルのテーマを作成するには、少なくとも以下の箇所に対してCSSを書く必要があります。このチェックリストをもとに、書き忘れた箇所がないか確認しましょう。

* ブログタイトル
* ブログのひとこと説明
* 記事
  * 日付
  * カテゴリー
  * 「編集」リンク
  * はてなブログタグへのリンク
  * 記事下の広告
  * 記事下の関連記事
    * 関連するとみられる記事がブログ内にあるとき表示されます。表示されない場合は、いくつか記事を投稿し、しばらく時間をおいてください。
  * コメント欄
* サイドバーモジュール
  * プロフィール、最新記事などの各モジュール
    * モジュールのオプションをすべて表示した状態で確認することをおすすめします
* ページャー
* フッターリンク
* Aboutページ
* Archiveページ
  * カテゴリーのパンくずリスト

### スタイルの記述が必要ないもの

以下の項目はあらかじめ標準のCSSが適用されているため、デザインテーマでスタイルの記述は不要です。

* ヘッダーメニュー
* Archiveページの検索ボックス
* 読者になるボタン
* はてなスター
* タグ
  * 必要があればコンテナ上下の余白を調整してください。

※ これらの要素にスタイルを記述した場合、将来のはてなブログの仕様変更によって、予告なく正常に表示されなくなることがあります。

## デザインとコーディングの注意事項

作成したテーマをテーマストアに投稿する際は、下記の注意事項を守ってください。

* 一般的に使用されているWebブラウザについて、各PC環境（WindowsまたはMac）の各最新版で正しく表示されるようにしてください（具体的にはヘルプ「はてなブログでの使用を推奨するWebブラウザ」を参照してください）。
  * レスポンシブデザインのテーマでは、スマートフォン環境（AndroidおよびiOS）での表示も確認してください。
* ヘッダ・フッタを移動したり隠したりしないでください。また、ヘッダメニューより上部やフッタより下部に要素を置かないでください。（border等の装飾も含む）。
* はてなブログのすべての機能が正しく使えるデザインにしてください。
  * やむを得ず一部の機能が利用できなかったり、隠れてしまう場合には、必ずテーマ ストアの「テーマの説明」欄にその旨を明記してください。
  * 機能が正常に使えないような場合には、選択されたライセンスの許諾事項に関わらず、はてなにて修正対応を行うことがございますのでご了承ください。
* テーマで使う画像のホスティングには、はてなフォトライフの利用を推奨します。
* 広告を隠したり、広告に別の要素を重ねて表示しないでください。
* カテゴリーに対して「タグ」または「ハッシュタグ（#）」の装飾を用いることは避けてください。これらのモチーフはタグを表すときに使います。
* 自分だけが使う目的で、テーマストアに非公開で投稿することは問題ありません。
  * ただし、はてなブログ以外のウェブページからCSSを参照する目的で投稿したり、はてなブログのデザインテーマに関係のないCSSを投稿した場合、テーマの公開停止や削除処置をとることがあります。

## デザインカスタマイズの仕様

### 背景画像

* ユーザーは「デザイン設定」の「カスタマイズ」タブの「背景画像」で、背景画像を設定できます。
* 用意された画像の中からも選ぶことも、ユーザーがアップロードすることもできます。
* ユーザーが背景を設定すると、選択した画像に応じて「デザインCSS」欄に下記のようなスタイルが指定されます。

```css
/* <system section="background" selected="bg1"> */
body{
 background-color:#3e2d1b;
 background-image:url('/images/theme/backgrounds/theme1.jpg');
 background-repeat:no-repeat;
 background-attachment:fixed;
 background-position:center top;
 background-size:cover; }
/* </system> */
```

### ヘッダ画像

* ユーザーは「デザイン設定」の「カスタマイズ」タブの「ヘッダ」で、自由に画像をアップロードできます。
* デフォルトで表示される画像のサイズは、高さが200px、横幅は最大1000pxです。
* ヘッダ画像を設定すると、div#blog-title-innerに下記のような専用のスタイルがインラインで指定されます。

```html
<div id="blog-title-inner" style="background-image: url('http://example.com/20121206113746.jpg');
 background-position: center ユーザーが「位置を調整する」で指定した表示領域のオフセット値 px;">
   <h1 id="title"><a href="/">はてなブログ開発検証用日記</a></h1>
   <h2 id="blog-description">ブログのひとこと説明</h2>
</div>
```

#### ヘッダ画像のクラス

* ヘッダ画像を指定すると、「表示設定」に応じてbodyタグに下記のクラスが付与されます。
* 基本的にスタイルはあらかじめ調整されており、各テーマで細かな調整を行います。

| ヘッダ画像の表示方法 | bodyに付与されるクラス |
| ---- | ---- |
| 画像なし | なし |
| 画像とテキストを表示 | header-image-enable |
| 画像だけ表示 | header-image-only |

### HTMLを自由記述できる箇所

* ユーザーは「デザイン設定」の「カスタマイズ」タブの下記の欄で、自由にHTMLを書くことができます。
* この部分には特にスタイルを書く必要はありませんが、余白などを整えてもよいでしょう。
* ユーザーが記述したHTMLは、次のようなIDやクラスが付与されたdiv内に置かれます。


| HTMLを記述できる箇所 | 表示されるページ | 付与されるセレクタ |
| ---- | ---- | ---- |
| タイトル下（ヘッダ） | すべてのページ | div#top-editarea |
| 記事上（記事） | 記事ページ | div.entry-header-html |
| 記事下（記事） | 記事ページ | div.entry-footer-html |
| フッタ | すべてのページ | div#bottom-editarea |


### Archiveページ

Archiveページは、「はてなブログのページ構成」で説明したように、過去の記事一覧を表示するページです。

Archiveページには、記事のサムネイルと本文冒頭が表示されます。以下にCSS記述例を挙げます。

```css
.page-archive .archive-entries .archive-entry {
  margin-bottom: 3em;
}
.page-archive .archive-entries .date {
  position: static;
}
.page-archive .archive-entries .entry-title {
  font-size: 130%;
  margin: 0 0 .5em;
}
.page-archive .archive-entries .categories {
  margin: 0 0 .5em;
}
.page-archive .archive-entries .entry-description {
  font-size: 100%;
  margin: 0 0 1em;
  line-height: 1.5em;
}
```

### ページャ

トップページと記事パーマリンクには、「過去の記事」「新しい記事（またはページ）」へのリンクとなるページャが表示されます。パーマリンクのページャには、記事タイトルが表示されます。以下にCSS記述例を挙げます。

```css
.pager {
    margin: 1em 0;
    display: block;
    *zoom: 1;
}
.pager:after {
    display: block;
    visibility: hidden;
    font-size: 0;
    height: 0;
    clear: both;
    content: ".";
}
.pager .pager-prev {
    float: left;
    text-align: left;
    width: 45%;
}
.pager .pager-next {
    float: right;
    text-align: right;
    width: 45%;
}
```

### ヘッダーメニュー

ヘッダーメニューとは、ブログの上部にある、はてなブログロゴやメニューが並んでいるバーです。あらかじめスタイルが適用されていますので、デザインテーマでのスタイリングは不要です。

### はてなブログPro

有料プラン「はてなブログPro」に加入しているユーザーのブログでは、はてなブログのヘッダーメニューとフッターリンクを表示しないようにできます。このときクラスなどに次のような変更があります。

* ヘッダーメニューの要素（#globalheader-container）が消える
* フッターリンクの要素（footer#footer）が消える
* 消えた状態を表すためglobalheader-offクラスがbodyに付与される

</hatena-blog-design-theme-creation-guide>
